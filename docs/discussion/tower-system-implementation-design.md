# Defense Allies íƒ€ì›Œ ì‹œìŠ¤í…œ êµ¬í˜„ ì„¤ê³„ ë¬¸ì„œ

## ğŸ“‹ ë¬¸ì„œ ì •ë³´
- **ì‘ì„±ì¼**: 2024ë…„
- **ë²„ì „**: v1.0
- **ëª©ì **: Defense Allies íƒ€ì›Œ ì‹œìŠ¤í…œ ìµœì  êµ¬í˜„ ë°©ì•ˆ
- **ë²”ìœ„**: ë ˆê³  ìŠ¤íƒ€ì¼ ëª¨ë“ˆí˜• íƒ€ì›Œ ì‹œìŠ¤í…œ

## ğŸ¯ ì„¤ê³„ ì² í•™ ë° í•µì‹¬ ì›ì¹™

### ì„¤ê³„ ëª©í‘œ
1. **ë ˆê³  ìŠ¤íƒ€ì¼ ëª¨ë“ˆì„±**: íƒ€ì›Œ ëŠ¥ë ¥ì„ ë¸”ë¡ì²˜ëŸ¼ ììœ ë¡­ê²Œ ì¡°í•©
2. **ë°ì´í„° ì£¼ë„ ê°œë°œ**: ëª¨ë“  ëŠ¥ë ¥ì„ JSON/YAMLë¡œ ì •ì˜ ê°€ëŠ¥
3. **ë¹ ë¥¸ í”„ë¡œí† íƒ€ì´í•‘**: 5ë¶„ ë‚´ ìƒˆë¡œìš´ íƒ€ì›Œ ìƒì„± ê°€ëŠ¥
4. **ì„œë²„ ê¶Œìœ„ì  ì²˜ë¦¬**: ëª¨ë“  ì „íˆ¬ ê³„ì‚°ì„ ì„œë²„ì—ì„œ ìˆ˜í–‰
5. **ë§¤íŠ¸ë¦­ìŠ¤ ê¸°ë°˜ ë°¸ëŸ°ì‹±**: NÃ—N ë§¤íŠ¸ë¦­ìŠ¤ë¡œ ë³µì¡í•œ ë°¸ëŸ°ìŠ¤ ê´€ë¦¬

### í•µì‹¬ ì•„í‚¤í…ì²˜ íŒ¨í„´
- **Data-Driven Component System**: ê¸°ë³¸ êµ¬ì¡°
- **Atomic Component Pattern**: ë ˆê³  ë¸”ë¡ êµ¬í˜„
- **Matrix-Driven Calculation**: ë°¸ëŸ°ì‹± ì‹œìŠ¤í…œ
- **Event-Driven Architecture**: ìƒí˜¸ì‘ìš© ì²˜ë¦¬
- **Rule-Based Behavior**: ì¡°ê±´ë¶€ ë¡œì§

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ê³„ì¸µ êµ¬ì¡°
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UI Layer (Visual Tower Builder)     â”‚ â† ë ˆê³  ìŠ¤íƒ€ì¼ ì—ë””í„°
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Data Layer (JSON/YAML Definitions)  â”‚ â† íƒ€ì›Œ ì •ì˜ ë°ì´í„°
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Logic Layer (Component System)      â”‚ â† ì»´í¬ë„ŒíŠ¸ ì¡°í•© ì—”ì§„
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Calculation Layer (Matrix Engine)   â”‚ â† ë§¤íŠ¸ë¦­ìŠ¤ ê¸°ë°˜ ê³„ì‚°
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Execution Layer (Server Combat)     â”‚ â† ì„œë²„ ì „íˆ¬ ì²˜ë¦¬
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í•µì‹¬ ì»´í¬ë„ŒíŠ¸

#### A. Atomic Component System
```go
type AtomicComponent interface {
    GetType() ComponentType
    Execute(context *ExecutionContext) ComponentResult
    GetInputs() []ComponentInput
    GetOutputs() []ComponentOutput
    CanConnectTo(other AtomicComponent) bool
}

// ê¸°ë³¸ ì»´í¬ë„ŒíŠ¸ íƒ€ì…ë“¤
- TargetingComponent    // íƒ€ê²Ÿ ì„ íƒ
- DamageComponent      // í”¼í•´ ê³„ì‚°
- EffectComponent      // ìƒíƒœ íš¨ê³¼
- RangeComponent       // ì‚¬ê±°ë¦¬ ì²˜ë¦¬
- CooldownComponent    // ì¿¨ë‹¤ìš´ ê´€ë¦¬
- ConditionalComponent // ì¡°ê±´ë¶€ ë¡œì§
```

#### B. Component Assembly Engine
```go
type ComponentAssembly struct {
    Components  []AtomicComponent
    Connections []ComponentConnection
    Metadata    AssemblyMetadata
}

type AssemblyEngine struct {
    ComponentRegistry *ComponentRegistry
    ConnectionValidator *ConnectionValidator
    ExecutionPlanner *ExecutionPlanner
}
```

#### C. Matrix Calculation Engine
```go
type MatrixEngine struct {
    BaseMatrices    map[string]Matrix
    ModifierEngine  *ModifierEngine
    BalanceEngine   *BalanceEngine
}
```

## ğŸ§± ë ˆê³  ìŠ¤íƒ€ì¼ ì»´í¬ë„ŒíŠ¸ ì„¤ê³„

### ì»´í¬ë„ŒíŠ¸ ì¹´í…Œê³ ë¦¬

#### 1. íƒ€ê²ŸíŒ… ë¸”ë¡
```yaml
targeting_blocks:
  single_target:
    inputs: []
    outputs: [target]
    config: [range, priority]
  
  multi_target:
    inputs: []
    outputs: [targets]
    config: [range, max_targets, priority]
  
  area_target:
    inputs: []
    outputs: [area_targets]
    config: [radius, center_type]
```

#### 2. ê³µê²© ë¸”ë¡
```yaml
attack_blocks:
  direct_damage:
    inputs: [targets]
    outputs: [damage_events]
    config: [base_damage, damage_type]
  
  projectile_attack:
    inputs: [targets]
    outputs: [projectiles]
    config: [projectile_speed, homing]
  
  chain_attack:
    inputs: [initial_target]
    outputs: [chain_events]
    config: [chain_count, damage_decay, chain_range]
```

#### 3. íš¨ê³¼ ë¸”ë¡
```yaml
effect_blocks:
  status_effect:
    inputs: [targets, trigger_data]
    outputs: [status_applications]
    config: [effect_type, duration, intensity]
  
  modifier_effect:
    inputs: [targets, base_values]
    outputs: [modified_values]
    config: [modifier_type, multiplier, duration]
```

### ë¸”ë¡ ì—°ê²° ì‹œìŠ¤í…œ
```json
{
  "tower_assembly": {
    "blocks": [
      {
        "id": "targeting_1",
        "type": "multi_target",
        "config": {"range": 8, "max_targets": 3}
      },
      {
        "id": "damage_1", 
        "type": "fire_damage",
        "config": {"base_damage": 100, "element": "fire"}
      },
      {
        "id": "effect_1",
        "type": "burn_effect", 
        "config": {"duration": 3, "dps": 20}
      }
    ],
    "connections": [
      {"from": "targeting_1.targets", "to": "damage_1.targets"},
      {"from": "damage_1.affected_targets", "to": "effect_1.targets"}
    ]
  }
}
```

## ğŸ“Š ë§¤íŠ¸ë¦­ìŠ¤ ê¸°ë°˜ ë°¸ëŸ°ì‹±

### ê¸°ë³¸ ë§¤íŠ¸ë¦­ìŠ¤ êµ¬ì¡°
```yaml
# 2x2 ê¸°ë³¸ ë§¤íŠ¸ë¦­ìŠ¤ (í™•ì¥ ê°€ëŠ¥)
power_matrix: [[offensive, defensive], [individual, cooperation]]

# ì¢…ì¡±ë³„ ê¸°ë³¸ ë§¤íŠ¸ë¦­ìŠ¤
dragon_base: [[1.5, 0.8], [1.2, 0.9]]  # ê³µê²© íŠ¹í™”
elven_base:  [[1.2, 1.0], [0.9, 1.3]]  # í˜‘ë ¥ íŠ¹í™”
dwarf_base:  [[1.0, 1.4], [1.1, 1.0]]  # ë°©ì–´ íŠ¹í™”
```

### ë§¤íŠ¸ë¦­ìŠ¤ ì—°ì‚° ì‹œìŠ¤í…œ
```go
type MatrixOperation interface {
    Apply(base Matrix, modifier Matrix) Matrix
}

// ì—°ì‚° íƒ€ì…ë“¤
- HadamardProduct  // í™˜ê²½ íš¨ê³¼ (ì›ì†Œë³„ ê³±ì…ˆ)
- MatrixMultiply   // ì‹œë„ˆì§€ íš¨ê³¼ (í–‰ë ¬ ê³±ì…ˆ)
- MatrixAdd        // ë²„í”„ íš¨ê³¼ (í–‰ë ¬ ë§ì…ˆ)
- ScalarMultiply   // ìŠ¤ì¼€ì¼ë§ (ìŠ¤ì¹¼ë¼ ê³±ì…ˆ)
```

## ğŸš€ ë¹ ë¥¸ í”„ë¡œí† íƒ€ì´í•‘ ì‹œìŠ¤í…œ

### í”„ë¦¬ì…‹ ì‹œìŠ¤í…œ
```json
{
  "presets": {
    "basic_archer": {
      "description": "ê¸°ë³¸ ì›ê±°ë¦¬ ê³µê²©",
      "assembly": {
        "blocks": ["single_targeting", "projectile_attack", "accuracy_check"],
        "auto_connect": true
      }
    },
    "flame_tower": {
      "description": "í™”ì—¼ ê³µê²© íƒ€ì›Œ",
      "assembly": {
        "blocks": ["area_targeting", "fire_damage", "burn_effect"],
        "auto_connect": true
      }
    }
  }
}
```

### í…œí”Œë¦¿ ì‹œìŠ¤í…œ
```yaml
templates:
  elemental_damage:
    variables: [element_type, base_damage, special_effect]
    structure:
      - type: "targeting_block"
      - type: "{{element_type}}_damage_block"
        config: {damage: "{{base_damage}}"}
      - type: "{{special_effect}}_block"
```

## ğŸ® ì„œë²„ ê¸°ë°˜ ì „íˆ¬ ì‹œìŠ¤í…œ

### ì „íˆ¬ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸
```
1. íƒ€ê²ŸíŒ… â†’ 2. ê³µê²© ê³„ì‚° â†’ 3. íš¨ê³¼ ì ìš© â†’ 4. ìƒíƒœ ë™ê¸°í™”
```

### ë°°ì¹˜ ì²˜ë¦¬ ìµœì í™”
```go
type CombatBatchProcessor struct {
    TowerBatch    []TowerAttack
    EffectBatch   []EffectApplication
    SynergyBatch  []SynergyCalculation
}
```

## ğŸ”§ êµ¬í˜„ ê¸°ìˆ  ìŠ¤íƒ

### ë°±ì—”ë“œ (Go)
- **ì»´í¬ë„ŒíŠ¸ ì‹œìŠ¤í…œ**: ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ ëª¨ë“ˆ ì„¤ê³„
- **ë§¤íŠ¸ë¦­ìŠ¤ ì—°ì‚°**: gonum/mat ë¼ì´ë¸ŒëŸ¬ë¦¬
- **JSON ì²˜ë¦¬**: encoding/json í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬
- **ë™ì‹œì„±**: goroutine + channel íŒ¨í„´

### ë°ì´í„° ì €ì¥ (Redis)
- **íƒ€ì›Œ ì •ì˜**: JSON ë¬¸ì„œë¡œ ì €ì¥
- **ê²Œì„ ìƒíƒœ**: í•´ì‹œë§µìœ¼ë¡œ ì‹¤ì‹œê°„ ìƒíƒœ ê´€ë¦¬
- **í”„ë¦¬ì…‹/í…œí”Œë¦¿**: í‚¤-ê°’ ì €ì¥

### í´ë¼ì´ì–¸íŠ¸ ë™ê¸°í™”
- **SSE**: ì‹¤ì‹œê°„ ìƒíƒœ ì—…ë°ì´íŠ¸
- **ë¸íƒ€ ì••ì¶•**: ë³€ê²½ì‚¬í•­ë§Œ ì „ì†¡
- **ì˜ˆì¸¡ ë Œë”ë§**: í´ë¼ì´ì–¸íŠ¸ ì¸¡ ë³´ê°„

## ğŸ“ˆ ì„±ëŠ¥ ìµœì í™” ì „ëµ

### ë©”ëª¨ë¦¬ ìµœì í™”
- **ì»´í¬ë„ŒíŠ¸ í’€ë§**: sync.Pool í™œìš©
- **ê°ì²´ ì¬ì‚¬ìš©**: ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ ìµœì†Œí™”
- **ìºì‹œ ì¹œí™”ì  ë°ì´í„°**: êµ¬ì¡°ì²´ ì •ë ¬

### ê³„ì‚° ìµœì í™”
- **ê³µê°„ ë¶„í• **: ê·¸ë¦¬ë“œ ê¸°ë°˜ ê·¼ì ‘ ê²€ìƒ‰
- **ë°°ì¹˜ ì²˜ë¦¬**: SIMD í™œìš© ê°€ëŠ¥í•œ êµ¬ì¡°
- **ì§€ì—° ê³„ì‚°**: í•„ìš”ì‹œì—ë§Œ ë§¤íŠ¸ë¦­ìŠ¤ ì—°ì‚°

### ë„¤íŠ¸ì›Œí¬ ìµœì í™”
- **ì ì‘ì  ì—…ë°ì´íŠ¸**: ë„¤íŠ¸ì›Œí¬ ìƒíƒœë³„ ë¹ˆë„ ì¡°ì ˆ
- **ì••ì¶•**: ë¸íƒ€ + ë”•ì…”ë„ˆë¦¬ ì••ì¶•
- **ë°°ì¹˜ ì „ì†¡**: ì—¬ëŸ¬ ì—…ë°ì´íŠ¸ ë¬¶ì–´ì„œ ì „ì†¡

## ğŸ¯ í™•ì¥ì„± ê³ ë ¤ì‚¬í•­

### ìˆ˜í‰ í™•ì¥
- **ìƒíƒœ ë¶„í• **: ê²Œì„ ë£¸ë³„ ì„œë²„ ë¶„ì‚°
- **ë¡œë“œ ë°¸ëŸ°ì‹±**: íƒ€ì›Œ ìˆ˜ì— ë”°ë¥¸ ë¶€í•˜ ë¶„ì‚°
- **ìºì‹œ ê³„ì¸µ**: Redis Cluster í™œìš©

### ê¸°ëŠ¥ í™•ì¥
- **ìƒˆ ì»´í¬ë„ŒíŠ¸**: í”ŒëŸ¬ê·¸ì¸ ë°©ì‹ìœ¼ë¡œ ì¶”ê°€
- **ìƒˆ ì—°ì‚°**: ë§¤íŠ¸ë¦­ìŠ¤ ì—°ì‚° ì¸í„°í˜ì´ìŠ¤ í™•ì¥
- **ìƒˆ ì´ë²¤íŠ¸**: ì´ë²¤íŠ¸ ë²„ìŠ¤ í™•ì¥

---

**ë‹¤ìŒ ë‹¨ê³„**: êµ¬í˜„ TODO ë¦¬ìŠ¤íŠ¸ ì‘ì„± ë° ë‹¨ê³„ë³„ ê°œë°œ ì§„í–‰
