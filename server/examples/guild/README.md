# Guild Management System - CQRS Event Sourcing Example

ì´ ì˜ˆì œëŠ” Defense Allies CQRS ì¸í”„ë¼ë¥¼ ì‚¬ìš©í•œ ê¸¸ë“œ ê´€ë¦¬ ì‹œìŠ¤í…œì…ë‹ˆë‹¤. ì‹¤ì‹œê°„ í˜‘ë ¥ ê²Œì„ì—ì„œ í•„ìš”í•œ ê¸¸ë“œ ê¸°ëŠ¥ë“¤ì„ CQRS íŒ¨í„´ìœ¼ë¡œ êµ¬í˜„í•©ë‹ˆë‹¤.

## ğŸ° ë„ë©”ì¸ ëª¨ë¸

### **ê¸¸ë“œ (Guild)**
- í”Œë ˆì´ì–´ë“¤ì´ ëª¨ì—¬ í˜‘ë ¥í•˜ëŠ” ì¡°ì§
- ê¸¸ë“œë§ˆìŠ¤í„°ì™€ ê¸¸ë“œì›ìœ¼ë¡œ êµ¬ì„±ëœ ê³„ì¸µ êµ¬ì¡°
- ì—­í•  ê¸°ë°˜ ê¶Œí•œ ì‹œìŠ¤í…œ
- ê³µë™ ìì› ê´€ë¦¬ (ê´‘ì‚°, ì±„êµ´, ìš´ì†¡)

### **ê¸¸ë“œì› (Guild Member)**
- ê¸¸ë“œì— ì†Œì†ëœ í”Œë ˆì´ì–´
- ì—­í• : ê¸¸ë“œë§ˆìŠ¤í„°, ë¶€ê¸¸ë“œë§ˆìŠ¤í„°, ì¼ë°˜ ê¸¸ë“œì›
- ê¶Œí•œ: ì´ˆëŒ€, ì¶”ë°©, ì±„êµ´, ìš´ì†¡ ë“±
- ìƒíƒœ: í™œì„±, ë¹„í™œì„±, íƒˆí‡´

### **ê´‘ì‚° (Mine)**
- ê¸¸ë“œê°€ ì†Œìœ í•˜ëŠ” ì±„êµ´ ì§€ì—­
- ì—¬ëŸ¬ ì¢…ë¥˜ì˜ ê´‘ë¬¼ ë³´ìœ 
- ì¼ê¾¼ ë°°ì¹˜ë¥¼ í†µí•œ ì±„êµ´ ì‹œìŠ¤í…œ
- ì±„êµ´ëŸ‰ê³¼ íš¨ìœ¨ì„± ê´€ë¦¬

### **ìš´ì†¡ (Transport)**
- ê´‘ì‚°ì—ì„œ ê¸¸ë“œë¡œ ê´‘ë¬¼ ìš´ì†¡
- ìš´ì†¡ ì¤‘ ë‹¤ë¥¸ ê¸¸ë“œì˜ ì¹¨ê³µ ê°€ëŠ¥
- ë°©ì–´ ì‹œê°„ê³¼ ì•½íƒˆ ë©”ì»¤ë‹ˆì¦˜
- ì‹¤ì‹œê°„ ìƒíƒœ ì¶”ì 

## ğŸ¯ ì£¼ìš” ê¸°ëŠ¥

### **ê¸¸ë“œ ê´€ë¦¬**
- ê¸¸ë“œ ìƒì„± ë° í•´ì²´
- ê¸¸ë“œ ì •ë³´ ìˆ˜ì • (ì´ë¦„, ì„¤ëª…, ê³µì§€ì‚¬í•­)
- ê¸¸ë“œ ê²€ìƒ‰ ë° ë­í‚¹ ì‹œìŠ¤í…œ
- ê¸¸ë“œ ì±„íŒ… ì‹œìŠ¤í…œ

### **íšŒì› ê´€ë¦¬**
- ê°€ì… ì‹ ì²­ ë° ìŠ¹ì¸/ê±°ì ˆ
- ê¸¸ë“œì› ì´ˆëŒ€ ì‹œìŠ¤í…œ
- ì—­í•  ë° ê¶Œí•œ ê´€ë¦¬
- ê¸¸ë“œì› ì¶”ë°© ë° íƒˆí‡´
- ê¸¸ë“œì› ìƒíƒœ ê°±ì‹ 

### **ê´‘ì‚° ë° ì±„êµ´**
- ê´‘ì‚° ë°œê²¬ ë° ì ë ¹
- ì¼ê¾¼ ë°°ì¹˜ ë° ê´€ë¦¬
- ì±„êµ´ íš¨ìœ¨ì„± ìµœì í™”
- ìì› ìƒì‚°ëŸ‰ ì¶”ì 

### **ìš´ì†¡ ë° ì¹¨ê³µ**
- ê´‘ë¬¼ ìš´ì†¡ ì‹œì‘
- ìš´ì†¡ ê²½ë¡œ ë° ì‹œê°„ ê´€ë¦¬
- ë‹¤ë¥¸ ê¸¸ë“œ ìš´ì†¡ ì¹¨ê³µ
- ë°©ì–´ ë° ì•½íƒˆ ì‹œìŠ¤í…œ

## ğŸ—ï¸ CQRS ì•„í‚¤í…ì²˜

### **Command Side (Write)**
```
Commands â†’ CommandHandlers â†’ Aggregates â†’ Events â†’ EventStore
```

### **Query Side (Read)**
```
Events â†’ EventHandlers â†’ Projections â†’ ReadModels â†’ Queries
```

### **ì‹¤ì‹œê°„ ì²˜ë¦¬**
```
Events â†’ EventBus â†’ SSE/WebSocket â†’ Client Updates
```

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
server/examples/guild/
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ guild_aggregate.go          # ê¸¸ë“œ Aggregate
â”‚   â”œâ”€â”€ member.go                   # ê¸¸ë“œì› Value Object
â”‚   â”œâ”€â”€ mine.go                     # ê´‘ì‚° Value Object
â”‚   â”œâ”€â”€ transport.go                # ìš´ì†¡ Value Object
â”‚   â”œâ”€â”€ role.go                     # ì—­í•  ë° ê¶Œí•œ ì •ì˜
â”‚   â””â”€â”€ events/
â”‚       â”œâ”€â”€ guild_created.go        # ê¸¸ë“œ ìƒì„± ì´ë²¤íŠ¸
â”‚       â”œâ”€â”€ member_joined.go        # íšŒì› ê°€ì… ì´ë²¤íŠ¸
â”‚       â”œâ”€â”€ member_left.go          # íšŒì› íƒˆí‡´ ì´ë²¤íŠ¸
â”‚       â”œâ”€â”€ member_promoted.go      # íšŒì› ìŠ¹ì§„ ì´ë²¤íŠ¸
â”‚       â”œâ”€â”€ mine_discovered.go      # ê´‘ì‚° ë°œê²¬ ì´ë²¤íŠ¸
â”‚       â”œâ”€â”€ mining_started.go       # ì±„êµ´ ì‹œì‘ ì´ë²¤íŠ¸
â”‚       â”œâ”€â”€ transport_started.go    # ìš´ì†¡ ì‹œì‘ ì´ë²¤íŠ¸
â”‚       â”œâ”€â”€ transport_attacked.go   # ìš´ì†¡ ì¹¨ê³µ ì´ë²¤íŠ¸
â”‚       â””â”€â”€ transport_completed.go  # ìš´ì†¡ ì™„ë£Œ ì´ë²¤íŠ¸
â”œâ”€â”€ application/
â”‚   â”œâ”€â”€ commands/
â”‚   â”‚   â”œâ”€â”€ guild_commands.go       # ê¸¸ë“œ ê´€ë ¨ ì»¤ë§¨ë“œ
â”‚   â”‚   â”œâ”€â”€ member_commands.go      # íšŒì› ê´€ë¦¬ ì»¤ë§¨ë“œ
â”‚   â”‚   â”œâ”€â”€ mining_commands.go      # ì±„êµ´ ê´€ë ¨ ì»¤ë§¨ë“œ
â”‚   â”‚   â””â”€â”€ transport_commands.go   # ìš´ì†¡ ê´€ë ¨ ì»¤ë§¨ë“œ
â”‚   â””â”€â”€ handlers/
â”‚       â”œâ”€â”€ guild_command_handler.go    # ê¸¸ë“œ ì»¤ë§¨ë“œ í•¸ë“¤ëŸ¬
â”‚       â””â”€â”€ guild_query_handler.go      # ê¸¸ë“œ ì¿¼ë¦¬ í•¸ë“¤ëŸ¬
â”œâ”€â”€ infrastructure/
â”‚   â”œâ”€â”€ projections/
â”‚   â”‚   â”œâ”€â”€ guild_summary.go        # ê¸¸ë“œ ìš”ì•½ í”„ë¡œì ì…˜
â”‚   â”‚   â”œâ”€â”€ member_list.go          # ê¸¸ë“œì› ëª©ë¡ í”„ë¡œì ì…˜
â”‚   â”‚   â”œâ”€â”€ guild_ranking.go        # ê¸¸ë“œ ë­í‚¹ í”„ë¡œì ì…˜
â”‚   â”‚   â”œâ”€â”€ mining_status.go        # ì±„êµ´ ìƒíƒœ í”„ë¡œì ì…˜
â”‚   â”‚   â””â”€â”€ transport_tracking.go   # ìš´ì†¡ ì¶”ì  í”„ë¡œì ì…˜
â”‚   â”œâ”€â”€ queries/
â”‚   â”‚   â”œâ”€â”€ search_guilds.go        # ê¸¸ë“œ ê²€ìƒ‰ ì¿¼ë¦¬
â”‚   â”‚   â”œâ”€â”€ get_guild_details.go    # ê¸¸ë“œ ìƒì„¸ ì¡°íšŒ
â”‚   â”‚   â”œâ”€â”€ get_member_list.go      # ê¸¸ë“œì› ëª©ë¡ ì¡°íšŒ
â”‚   â”‚   â”œâ”€â”€ get_guild_ranking.go    # ê¸¸ë“œ ë­í‚¹ ì¡°íšŒ
â”‚   â”‚   â””â”€â”€ get_transport_status.go # ìš´ì†¡ ìƒíƒœ ì¡°íšŒ
â”‚   â””â”€â”€ chat/
â”‚       â”œâ”€â”€ guild_chat_handler.go   # ê¸¸ë“œ ì±„íŒ… í•¸ë“¤ëŸ¬
â”‚       â””â”€â”€ chat_projection.go      # ì±„íŒ… í”„ë¡œì ì…˜
â”œâ”€â”€ main.go                         # ë©”ì¸ ì‹¤í–‰ íŒŒì¼
â””â”€â”€ README.md                       # ì´ íŒŒì¼
```

## ğŸš€ ì‹¤í–‰ ë°©ë²•

```bash
cd server/examples/guild
go run main.go
```

## ğŸ“Š ì´ë²¤íŠ¸ ì†Œì‹± í”Œë¡œìš°

### **ê¸¸ë“œ ìƒì„± í”Œë¡œìš°**
1. `CreateGuildCommand` â†’ `GuildCreatedEvent`
2. `InviteMemberCommand` â†’ `MemberInvitedEvent`
3. `AcceptInvitationCommand` â†’ `MemberJoinedEvent`

### **ì±„êµ´ í”Œë¡œìš°**
1. `DiscoverMineCommand` â†’ `MineDiscoveredEvent`
2. `StartMiningCommand` â†’ `MiningStartedEvent`
3. `AssignWorkerCommand` â†’ `WorkerAssignedEvent`

### **ìš´ì†¡ ë° ì¹¨ê³µ í”Œë¡œìš°**
1. `StartTransportCommand` â†’ `TransportStartedEvent`
2. `AttackTransportCommand` â†’ `TransportAttackedEvent`
3. `DefendTransportCommand` â†’ `TransportDefendedEvent`
4. `CompleteTransportCommand` â†’ `TransportCompletedEvent`

ê° ì´ë²¤íŠ¸ëŠ” EventStoreì— ì €ì¥ë˜ê³ , Projectionì„ í†µí•´ ReadModelì´ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.

## ğŸ® Defense Allies CQRS í™œìš©

ì´ ì˜ˆì œëŠ” ë‹¤ìŒ Defense Allies CQRS ì»´í¬ë„ŒíŠ¸ë“¤ì„ í™œìš©í•©ë‹ˆë‹¤:

- `AggregateRoot` - ê¸¸ë“œ Aggregate êµ¬í˜„
- `DomainEventMessage` - ë„ë©”ì¸ ì´ë²¤íŠ¸ ì •ì˜
- `CommandHandler` - ì»¤ë§¨ë“œ ì²˜ë¦¬
- `EventHandler` - ì´ë²¤íŠ¸ ì²˜ë¦¬ ë° í”„ë¡œì ì…˜
- `EventSourcedRepository` - ì´ë²¤íŠ¸ ì†Œì‹± ì €ì¥ì†Œ
- `QueryDispatcher` - ì¿¼ë¦¬ ì²˜ë¦¬
- `EventBus` - ì‹¤ì‹œê°„ ì´ë²¤íŠ¸ ì „íŒŒ

## ğŸ“ˆ í™•ì¥ ê°€ëŠ¥ì„±

- ê¸¸ë“œ ì—°í•© ì‹œìŠ¤í…œ
- ê¸¸ë“œ ì „ìŸ ë° í† ë„ˆë¨¼íŠ¸
- ê³ ê¸‰ ê¶Œí•œ ê´€ë¦¬ ì‹œìŠ¤í…œ
- ê¸¸ë“œ ìƒì  ë° ê²½ì œ ì‹œìŠ¤í…œ
- ê¸¸ë“œ ì—…ì  ë° ë³´ìƒ ì‹œìŠ¤í…œ
- í¬ë¡œìŠ¤ ì„œë²„ ê¸¸ë“œ ì‹œìŠ¤í…œ

## ğŸ”§ ê¸°ìˆ ì  íŠ¹ì§•

- **Event Sourcing**: ëª¨ë“  ê¸¸ë“œ í™œë™ì˜ ì™„ì „í•œ ì´ë ¥ ì¶”ì 
- **CQRS**: ì½ê¸°/ì“°ê¸° ìµœì í™”ëœ ë¶„ë¦¬ ì•„í‚¤í…ì²˜
- **ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸**: EventBusë¥¼ í†µí•œ ì¦‰ì‹œ ìƒíƒœ ë™ê¸°í™”
- **í™•ì¥ì„±**: Redis ê¸°ë°˜ ë¶„ì‚° ì²˜ë¦¬ ì§€ì›
- **ë™ì‹œì„± ì œì–´**: Optimistic Concurrency Control
- **ë³µì›ë ¥**: ì´ë²¤íŠ¸ ì¬ìƒì„ í†µí•œ ìƒíƒœ ë³µêµ¬

ì´ ì˜ˆì œë¥¼ í†µí•´ ë³µì¡í•œ ë©€í‹°í”Œë ˆì´ì–´ ê²Œì„ì˜ ê¸¸ë“œ ì‹œìŠ¤í…œì„ CQRS íŒ¨í„´ìœ¼ë¡œ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ í•™ìŠµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
